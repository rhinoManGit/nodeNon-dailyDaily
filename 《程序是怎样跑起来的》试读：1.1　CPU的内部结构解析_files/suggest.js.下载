!function(t,e,i){var s="searchSuggest",n=".item",o={9:"tab",27:"esc",38:"up",40:"down",13:"enter"},r=(e.document,{url:"",tmplEngine:"",tmplPanel:"",tmplItem:"",queryArg:""}),h={preventSearch:function(t){return""===t},parse:function(t){return t},delay:300,dataType:"json",highlighter:function(t){var e=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return t.replace(new RegExp("("+e+")","ig"),function(t,e){return"<strong>"+e+"</strong>"})},form:"",onSelect:function(t,e){e.submit()},autoFindForm:!1};t.extend(r,h);var a=function(e,i){this.el=e,this.$el=t(this.el),this.options=t.extend({},r,i),this.initalize(i)};t.extend(a.prototype,{initalize:function(){if(this.$el.attr({autocomplete:"off",dir:"ltr"}),this.preventSearch=this.options.preventSearch,this.template=this.options.tmplEngine,this.parse=this.options.parse,this.highlighter=this.options.highlighter,this.options.autoFindForm){var t=this.$el.closest("form");t.length&&(this.form=t)}else this.form=this.options.form;this.listen()},listen:function(){this.$el.on("input propertychange",t.proxy(this.input,this)).on("keyup",t.proxy(this.keyup,this)).on("keypress",t.proxy(this.keypress,this)).on("blur",t.proxy(this.blur,this)).on("beforedeactivate",t.proxy(function(){if(this.isOverSuggestion)return!1},this)).on("focus",t.proxy(this.focus,this)),(t.browser.chrome||t.browser.webkit||t.browser.msie)&&this.$el.on("keydown",t.proxy(this.keydown,this))},focus:function(t){this.isOverSuggestion=!1,this.isFocused=!0,this.manualLookup()},manualLookup:function(){var t=this.val();if(t.length){if(this.preventSearch(t))return;this.lookup(this.val())}},blur:function(t){return this.isOverSuggestion?void t.preventDefault():(this.hide(),void(this.isFocused=!1))},keyup:function(t){t.stopPropagation(),t.preventDefault()},keydown:function(e){this.suppressKeyPressRepeat=!~t.inArray(e.keyCode,[40,38,9,13,27]),this.move(e)},keypress:function(t){this.suppressKeyPressRepeat||this.move(t)},move:function(t){if(this.shown){switch(o[t.keyCode]){case"tab":case"esc":t.preventDefault();break;case"up":t.preventDefault(),this.prev();break;case"down":t.preventDefault(),this.next();break;case"enter":t.preventDefault(),this.select()}t.stopPropagation()}},input:function(e){if(this.isFocused){if("propertychange"===e.type&&this.propertychangeSilent)return void(this.propertychangeSilent=!1);var i=this.val();return this.delay&&(clearTimeout(this.delay),delete this.delay),this.preventSearch(i)?void(this.shown&&this.hide()):void(this.delay=setTimeout(t.proxy(function(){this.lookup(i)},this),this.options.delay))}},val:function(t){return t?(this.propertychangeSilent=!0,void this.$el.val(t)):this.$el.val()},select:function(){var t=this.getPanel(),e=t.find(".active"),i=e.text();this.val(i),this.hide(),this.options.onSelect&&this.options.onSelect(i,this.form)},next:function(){var t=this.getPanel(),e=t.find(".active");if(!e.length)return void t.find(n).first().toggleClass("active");var i=e.next();e.removeClass("active"),i.length&&i.addClass("active")},prev:function(){var t=this.getPanel(),e=t.find(".active");if(!e.length)return void t.find(n).last().toggleClass("active");var i=e.prev();e.removeClass("active"),i.length&&i.addClass("active")},render:function(e){this.renderQuery=this.query;var i=this.getPanel();return i.empty(),t.each(e,t.proxy(function(t,e){i.append(this.template(this.options.tmplItem,{item:this.highlighter(e)}))},this)),this},renderShow:function(){var t=this.getPanel(),e=t.find(".active");e.length&&e.removeClass("active"),this.show()},show:function(){var e=this.getPanel(),i=t.extend({},this.$el.offset(),{height:this.el.offsetHeight});return e.css({top:i.top+i.height-1,left:i.left}),e.show(),this.shown=!0,this},hide:function(){this.getPanel().hide(),this.shown=!1},mouseenterItem:function(e){var i=t(e.currentTarget),s=this.getPanel(),n=s.find(".active");n.length&&n.removeClass("active"),i.toggleClass("active")},clickItem:function(t){t.preventDefault(),this.select()},getPanel:function(){if(this.panel_singleton)return this.panel_singleton;this.panel_singleton=t(this.options.tmplPanel);var e=this.panel_singleton;t("body").append(e),e.on("mouseenter",n,t.proxy(this.mouseenterItem,this)),e.on("click",n,t.proxy(this.clickItem,this)),e.on("dragstart mousedown",n,function(t){t.preventDefault()});var i=this;return e.hover(function(){i.isOverSuggestion=!0},function(){i.isOverSuggestion=!1}),e},lookup:function(e){this.jqXhr&&this.jqXhr.abort(),this.query=e;var i={};return this.renderQuery===this.query?void this.renderShow():(i[this.options.queryArg]=this.query,void(this.jqXhr=t.get(this.options.url,i,t.proxy(this.lookupSuccess,this),this.options.dataType)))},lookupSuccess:function(t){return t=this.parse(t),t?this.render(t).show():this.hide()}}),t.fn[s]=function(e){return this.each(function(){t.data(this,"plugin_"+s)||t.data(this,"plugin_"+s,new a(this,e))})}}(jQuery,window);